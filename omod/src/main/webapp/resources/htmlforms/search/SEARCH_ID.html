<!--
  ~ The contents of this file are subject to the OpenMRS Public License
  ~ Version 1.0 (the "License"); you may not use this file except in
  ~ compliance with the License. You may obtain a copy of the License at
  ~ http://license.openmrs.org
  ~
  ~ Software distributed under the License is distributed on an "AS IS"
  ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or impliediaxd. See the
  ~ License for the specific language governing rights and limitations
  ~ under the License.
  ~
  ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
-->
<htmlform>

    <style type="text/css">
        table.SEARCHID {
            border-collapse: collapse;
        //background-color: #F3F9FF;
        }
        table.SEARCHID > tbody > tr > td, table.SEARCHID > tbody > tr > th {
            border: 1px solid black;
            vertical-align: baseline;
            padding: 4px;
            text-align: left;
        }
    </style>

    <script type="text/javascript">
        function validateSEARCH_ID(search_id)
        {
            /************************************************
             DESCRIPTION: Validates that a SEARCH ID is in the right format.

             PARAMETERS:
             search_id - String to be tested for validity

             RETURNS:
             True if valid, otherwise false.
             **************************************************/
            var objRegExp  = /^(31|32|33|34|35|36|37|38|39|40|41|42)-[0-9]{1}-[0-9]{2}-(500|501|502|503|504|505|506|507|508|509|510|511|512|513|514|515|516|517|518|519|520|521|522|523|524|525|526|527|528|529|530|531|532|533|534|535|536|537|538|539|540|541|542|543|544|545|546|547|548|549|550|551|552|553|554|555|556|557|558|559|560|561|562|563|564|565|566|567|568|569|570|571|572|573|574|575|576|577|578|579|580|581|582|583|584|585|586|587|588|589|590|591|592|593|594|595|596|597|598|599|600|601|602|603|604|605|606|607|608|609|610|611|612|613|614|615|616|617|618|619|620|621|622|623|624|625|626|627|628|629|630|631|632|633|634|635|636|637|638|639|640|641|642|643|644|645|646|647|648|649|650|651|652|653|654|655|656|657|658|659|660|661|662|663|664|665|666|667|668|669|670|671|672|673|674|675|676|677|678|679|680|681|682|683|684|685|686|687|688|689|690|691|692|693|694|695|696|697|698|699|999)-[0-9]{3}-[0-9]{1,3}$/;

            //check for integer characters
            return objRegExp.test(search_id);

        }

        jq(function(){

            jq('#hei-id').change(function(){
                //alert(this.id)
                /********************************
                 Get A text Input from a span
                 *********************************/
                var text_val=jq('#search-id').find('input[type=text]').val();

                if(validateSEARCH_ID(text_val)=="false")
                {
                    getField('pat_id.error').html('The SEARCH Identifier is in the wrong Format... e.g. 31-1-02-500-577-1').show();
                }

            });


        });

        beforeSubmit.push(function() {
            /* validate the SEARCHID before the form is submitted */

            var text_val=jq('#search-id').find('input[type=text]').val();
            //alert(validateSEARCH_ID(text_val));
            if(validateSEARCH_ID(text_val)==false)
            {
                //jq('#search-id').html('The SEARCH Identifier is in the wrong Format... e.g. 31-2-01-599-444-1');
                alert('The SEARCH Identifier is in the wrong Format. The right format should for example be 31-2-01-599-444-1');
                return false
            }

            return true;
        });
    </script>
    <div style="display:none">
        <encounterProvider default="ae01b8ff-a4cc-4012-bcf7-72359e852e14"  />   <!-- "1cc7dc79-ad09-4897-8a1d-0b3d3226e9ee" -->
    </div>
    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td>Date: <encounterDate id="encounter-date" showTime="false"/></td>
                <td>Enrolled at: <encounterLocation id="site" default="GlobalProperty:kenyaemr.defaultLocation"/></td>
            </tr>
        </table>
    </div>

    <div class="ke-form-content">

        <table class="SEARCHID" align="center">
            <tbody>
            <tr>
                <td colspan="15" style="background-color: #696969; color: #ffffff; text-align:center;">
                    <a name="page1"></a>
                    SEARCH Study participant identification
                </td>
            </tr>
            <tr>
                <td colspan="15">
                    <h3 align="center">ADDING THE SEARCHID TO THE PARTICIPANT'S FILE</h3>
                </td>
            </tr>
            <tr>
                <td colspan="15">
                    <table>
                        <tr>
                            <td>
                                Patient's Names: <lookup class="value" expression="patient.personName"/> <br/>
                                Unique ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Unique Patient Number') ) $patId #end "/><br/>
                                FACES ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Patient Clinic Number') ) $patId #end "/><br/>
                                SEARCH ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('SEARCH ID Number') ) $patId #end "/><br/>
                                HEI ID:<lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('HEI ID Number') ) $patId #end "/><br/>
                                Date of Birth: <lookup class="value" id="dob" expression="patient.birthdate"/> <br/>
                                Age: <lookup class="value" id="age" expression="patient.age"/>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="15" style="background-color: #696969; color: #ffffff;">
                    SEARCH ID
                </td>
            </tr>
            <tr>
                <td colspan="15">SEARCH ID Number:
                    <span id="search-id"><patient id="pat_id" field="identifier" identifierTypeId="02c0d163-0373-41f3-8f92-434b13184c77" required="true" /></span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="ke-form-footer">
        <submit />
    </div>
</htmlform>