<!--
      ~ The contents of this file are subject to the OpenMRS Public License
      ~ Version 1.0 (the "License"); you may not use this file except in
      ~ compliance with the License. You may obtain a copy of the License at
      ~ http://license.openmrs.org
      ~
      ~ Software distributed under the License is distributed on an "AS IS"
      ~ basis, WITHOUT WARRANTY OF ANY KIND, either express or implied. See the
      ~ License for the specific language governing rights and limitations
      ~ under the License.
      ~
      ~ Copyright (C) OpenMRS, LLC.  All Rights Reserved.
    -->
<htmlform>

    <style type="text/css">
        table.screen {
            border-collapse: collapse;
        }
        table.screen > tbody > tr > td, table.screen > tbody > tr > th {
            border: 1px solid black;
            vertical-align: baseline;
            padding: 4px;
        }
    </style>
    <script type="text/javascript">
        var UNABLE_CONCEPT_ID = 162874;
        var CONSENT_CONCEPT_ID = 162880;
        var DEATH_CONCEPT_ID = 160432;
        var OTHER_CONCEPT_ID = 5622;

        /* Skipping Patterns and dropped fields*/
        function explain_other()
        {
            if(getValue('other.value')== OTHER_CONCEPT_ID)
            {
                jq('#explanation').show();
            }
            else
            {
                jq('#explanation').hide();
            }
        }

        jq(function(){
            /*Limiting REASON FOR SUBJECT WITHDRAWAL to one choice*/
            getField('unable.value').change(function(){
                if(getValue('unable.value')== UNABLE_CONCEPT_ID)
                    setValue('consent.value', '')
                setValue('death.value', '')
                setValue('other.value', '')
            });
            getField('consent.value').change(function(){
                if(getValue('consent.value')== CONSENT_CONCEPT_ID)
                    setValue('unable.value', '')
                setValue('death.value', '')
                setValue('other.value', '')
            });
            getField('death.value').change(function(){
                if(getValue('death.value')== DEATH_CONCEPT_ID)
                    setValue('unable.value', '')
                setValue('consent.value', '')
                setValue('other.value', '')
            });
            getField('other.value').change(function(){
                if(getValue('other.value')== OTHER_CONCEPT_ID)
                    setValue('unable.value', '')
                setValue('consent.value', '')
                setValue('death.value', '')
            });


            getField('other.value').change(explain_other);
            getField('unable.value').change(explain_other);
            getField('consent.value').change(explain_other);
            getField('death.value').change(explain_other);
            explain_other();

        });
    </script>

    <div style="display:none">
        <encounterProvider default="ae01b8ff-a4cc-4012-bcf7-72359e852e14" />
    </div>
    <div class="ke-form-header">
        <table style="width: 100%">
            <tr>
                <td>Date: <encounterDate id="encounter-date" showTime="true"/></td>
                <td>Enrolled at: <encounterLocation id="site" default="GlobalProperty:kenyaemr.defaultLocation"/></td>
            </tr>
        </table>

    </div>
    <div class="ke-form-content">


        <table class="screen" align="center" width="970px">
            <tbody>
            <tr style="background-color: #696969; font-weight: bold;">
                <td align="center" style="background-color: #696969; color: #ffffff;">
                    <a name="page1"></a>
                    CRF-11 ART Delivery - Subject Withdrawal FORM
                </td>
            </tr>
            <tr>
                <td>
                    <table width="100%">
                        <td rowspan="2" width="25%"></td>
                        <td rowspan="2" width="25%"></td>
                        <td rowspan="2" width="35%">Participant initials:<lookup class="value" expression="patient.personName"/></td>
                        <td style="background-color:lightcyan;">Clinic ID:
                            <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Faces ID') ) $patId #end "/>
                        </td>
                        <tr>
                            <td style="background-color:lightcyan;">SEARCH ID:
                                <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('SEARCH ID') ) $patId #end "/>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="background-color: #696969; color: #ffffff;" align="center">
                    Subject Withdrawal FORM
                </td>
            </tr>
            <tr>
                <td>
                    <table class="screen"  width="98%" align="center">
                        <tr style="background-color: #696969; font-weight: bold;">
                            <td align="center" width="50%">REASON FOR SUBJECT WITHDRAWAL</td>
                            <td align="center">
                                CRITERIA FOR WITHDRAWAL DATE DETERMINATION</td>
                        </tr>
                        <tr>
                            <td>
                                <obs id="unable"
                                     conceptId="161555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptId="162874AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabel="" style="radio"/>
                                Participant no longer able to participate<br/>
                                (Moved out of study community, unable to swallow oral medications, etc.)
                            </td>
                            <td>Withdrawal date = date of investigatorâ€™s decision</td>
                        </tr>
                        <tr>
                            <td>
                                <obs id="consent"
                                     conceptId="161555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptId="162880AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabel="" style="radio"/>
                                Withdrawal of informed consent
                            </td>
                            <td>Withdrawal date = date of withdrawal of informed consent</td>
                        </tr>
                        <tr>
                            <td>
                                <obs id="death"
                                     conceptId="161555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptId="160432AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabel="" style="radio"/>Study participant death

                            </td>
                            <td>Withdrawal date=date of death</td>
                        </tr>
                        <tr>
                            <td>
                                <obs id="other"
                                     conceptId="161555AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerConceptId="5622AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
                                     answerLabel="" style="radio"/>Other reason

                            </td>
                            <td>Explain the other reasons<obs id="explanation" conceptId="161011AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td>
                    <table class="screen" align="center" width="98%">
                        <tr>
                            <td align="center">
                                <strong>WITHDRAWAL DATE: </strong><obs id="withdrawDate" conceptId="160753AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"/></td>
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td style="text-align:center;">
                    <div class="ke-form-buttons">
                        <submit />
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td style="font-style: italic;">Version 1.1; 25 June 2013</td>
                        </tr>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</htmlform>